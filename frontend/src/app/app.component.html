<ng-container *ngIf="auth.isAuthenticated(); else publicShell">
  <div class="layout-shell">
    <aside class="layout-sidebar">
      <div class="sidebar-brand">
        <span>Financial Dashboard</span>
        <strong>Finlo</strong>
      </div>
      <nav class="nav-list">
        <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" class="nav-item">Dashboard</a>
        <a routerLink="/accounts" routerLinkActive="active" class="nav-item">Accounts</a>
        <a routerLink="/connections" routerLinkActive="active" class="nav-item">Connections</a>
        <a routerLink="/transactions" routerLinkActive="active" class="nav-item">Transactions</a>
        <a routerLink="/budgets" routerLinkActive="active" class="nav-item">Budgets</a>
      </nav>
      <footer class="nav-footer">Secure banking overview · {{ store.accounts().length }} accounts</footer>
    </aside>

    <div class="layout-content">
      <div *ngIf="auth.postResetNotice() as notice" class="notice-banner">
        <span>{{ notice }}</span>
        <button type="button" (click)="dismissPostResetNotice()">Dismiss</button>
      </div>
      <header class="topbar">
        <div class="search-field">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="none" aria-hidden="true">
            <path d="M13.8333 12.5H14.5833L18.3333 16.25L16.25 18.3333L12.5 14.5833V13.8333L12.25 13.5833C11.0417 14.5417 9.5 15.0833 7.83333 15.0833C3.91667 15.0833 0.833333 12 0.833333 8.08333C0.833333 4.16667 3.91667 1.08333 7.83333 1.08333C11.75 1.08333 14.8333 4.16667 14.8333 8.08333C14.8333 9.75 14.2917 11.2917 13.3333 12.5L13.8333 12.5ZM3.83333 8.08333C3.83333 10.375 5.54167 12.0833 7.83333 12.0833C10.125 12.0833 11.8333 10.375 11.8333 8.08333C11.8333 5.79167 10.125 4.08333 7.83333 4.08333C5.54167 4.08333 3.83333 5.79167 3.83333 8.08333Z" fill="currentColor"/>
          </svg>
          <input type="search" placeholder="Search accounts, transactions…" />
        </div>
        <div class="user-card">
          <div class="user-meta">
            <p class="muted">Hello, {{ greetingName() }}</p>
            <span class="status" *ngIf="!auth.emailVerified()">
              Verify your email to unlock more features
            </span>
            <p class="status-message" *ngIf="resendMessage()">{{ resendMessage() }}</p>
            <div class="auth-actions">
              <button type="button" class="link-button" (click)="signOut()">Sign out</button>
              <button
                type="button"
                class="link-button"
                *ngIf="!auth.emailVerified()"
                [disabled]="resendState() === 'loading'"
                (click)="resendVerification()"
              >
                {{ resendState() === 'loading' ? 'Sending…' : 'Resend verification email' }}
              </button>
            </div>
            <div class="dev-hint" *ngIf="devVerificationToken()">
              Dev token: <code>{{ devVerificationToken() }}</code>
            </div>
          </div>
          <div class="account-filter">
            <label for="accountSelector" class="muted">Account filter</label>
            <select id="accountSelector" (change)="onAccountChange($any($event.target).value)">
              <option value="">All accounts</option>
              <option *ngFor="let a of store.accounts()" [value]="a.id">{{ a.name }}</option>
            </select>
          </div>
          <div class="avatar">{{ avatarInitials() }}</div>
        </div>
      </header>

      <main>
        <router-outlet></router-outlet>
      </main>
    </div>
  </div>
</ng-container>
<ng-template #publicShell>
  <router-outlet></router-outlet>
</ng-template>
